<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üéµ –í–≥–∞–¥–∞–π –º–µ–ª–æ–¥—ñ—é ‚Äî Prototype</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#121a27cc;
      --text:#e8eefc;
      --muted:#a9b5d3;
      --border:#253150;
      --tileBg: rgba(8, 12, 24, 0.95);
      --tileHover: rgba(20, 28, 55, 0.98);
      --primary:#152248;
      --primaryBorder:#3d5bd6;
      --danger:#2a1414;
      --dangerBorder:#6b2a2a;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; }
    .app{ height:100%; display:grid; grid-template-rows:auto 1fr; }
    .topbar{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      padding:10px 12px; background:var(--panel); backdrop-filter: blur(8px);
      border-bottom:1px solid #27324a;
    }
    .left, .right{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .meta{ display:flex; flex-direction:column; line-height:1.1; }
    .meta .title{ font-weight:900; letter-spacing:.2px; }
    .meta .sub{ color:var(--muted); font-size:12px; }

    .btn{
      appearance:none; border:1px solid #2a3754; background:#121a27;
      color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer;
      font-weight:800; letter-spacing:.2px;
      transition:transform .05s ease, background .15s ease, border-color .15s ease;
      user-select:none;
      text-decoration:none;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{ background:#18233a; border-color:#3a4c74; }
    .btn:active{ transform:scale(0.98); }
    .btn.primary{ border-color:var(--primaryBorder); background:var(--primary); }
    .btn.danger{ border-color:var(--dangerBorder); background:var(--danger); color:#ffd5d5; }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .btn.ghost{ background:transparent; border-color:#2a3754; }
    .btn.ghost:hover{ background:#18233a; }
    .kbd{ font-family:ui-monospace, SFMono-Regular, Menlo, monospace; font-size:12px; padding:2px 6px; border:1px solid #2a3754; border-radius:8px; color:var(--muted); }

    .stage{ display:grid; place-items:center; padding:14px; }
    .card{
      width:min(1100px, 94vw);
      border:1px solid var(--border);
      border-radius:18px;
      background:rgba(15,23,42,.55);
      backdrop-filter: blur(10px);
      box-shadow:0 20px 60px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .cardInner{ padding:16px; display:grid; gap:14px; }

    .words{
      display:grid;
      grid-template-columns:repeat(5, minmax(0,1fr));
      gap:12px;
    }
    .wordTile{
      height: clamp(90px, 18vh, 160px);
      border-radius:16px;
      border:1px solid #2a3754;
      background:var(--tileBg);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      transition: background .15s ease, transform .08s ease, opacity .25s ease;
      padding:10px;
      text-align:center;
    }
    .wordTile:hover{ background:var(--tileHover); }
    .wordTile:active{ transform:scale(0.98); }
    .wordTile .num{
      font-weight:950;
      font-size: clamp(26px, 4vw, 44px);
      color:#fff;
      opacity:.95;
      text-shadow:0 2px 10px rgba(0,0,0,.6);
    }
    .wordTile.opened .num{ display:none; }
    .wordTile .word{
      display:none;
      font-weight:950;
      font-size: clamp(18px, 3.2vw, 42px);
      letter-spacing:.2px;
      line-height:1.05;
      color:#fff;
      text-shadow:0 2px 16px rgba(0,0,0,.55);
      word-break: break-word;
    }
    .wordTile.opened .word{ display:block; }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      border-top:1px solid #27324a;
      padding-top:12px;
      margin-top:4px;
    }
    .stat{ color:var(--muted); font-size:13px; }
    .range{
      display:flex; gap:10px; align-items:center; color:var(--muted); font-size:13px;
      padding:8px 10px; border:1px solid #2a3754; border-radius:12px; background:rgba(18,26,39,.55);
    }
    input[type="range"]{ width:140px; }

    .answerOverlay{
      display:none;
      margin-top:6px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid #2a3754;
      background:rgba(15,23,42,.70);
    }
    .answerOverlay.show{ display:block; }
    .answerTitle{ font-weight:950; font-size: clamp(18px, 2.2vw, 28px); }
    .hint{ color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35; }

    @media (max-width: 720px){
      .words{ grid-template-columns:1fr; }
      .wordTile{ height:110px; }
      input[type="range"]{ width:120px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="left">
        <a class="btn ghost" href="../../" title="–ù–∞–∑–∞–¥ –¥–æ –º–µ–Ω—é">‚Üê –ú–µ–Ω—é</a>
        <div class="meta">
          <div class="title">üéµ –í–≥–∞–¥–∞–π –º–µ–ª–æ–¥—ñ—é</div>
          <div class="sub">
            –í—ñ–¥–∫—Ä–∏–π —Å–ª–æ–≤–∞ (5 –±–ª–æ–∫—ñ–≤) —ñ –≤–≥–∞–¥–∞–π –ø—ñ—Å–Ω—é ¬∑
            <span id="openedInfo">–í—ñ–¥–∫—Ä–∏—Ç–æ: 0/5</span>
            ¬∑ <span id="packInfo">–ü–∞–∫: demo</span>
          </div>
        </div>
      </div>

      <div class="right">
        <button class="btn" id="btnUndo" title="Undo (U)">Undo <span class="kbd">U</span></button>
        <button class="btn" id="btnReset" title="Reset (R)">Reset <span class="kbd">R</span></button>
        <button class="btn" id="btnReveal" title="Reveal all">Reveal</button>
        <button class="btn primary" id="btnAnswer" title="–ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (A)">Answer <span class="kbd">A</span></button>
        <button class="btn danger" id="btnNext" title="Next (N)">Next <span class="kbd">N</span></button>
      </div>
    </div>

    <div class="stage">
      <div class="card">
        <div class="cardInner">

          <div class="words" id="words"></div>

          <div id="answerOverlay" class="answerOverlay">
            <div class="answerTitle" id="answerText">–í—ñ–¥–ø–æ–≤—ñ–¥—å</div>
            <div class="hint">–ö—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ 5 –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø—ñ–¥–∫–∞–∑–æ–∫ (—Å–ª–æ–≤–∞/—Ñ—Ä–∞–∑–∏), –∞ –Ω–µ –¥–æ–≤–≥—ñ —Ç–µ–∫—Å—Ç–∏.</div>
          </div>

          <div class="controls">
            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
              <button class="btn primary" id="btnPlay">‚ñ∂ Play</button>
              <button class="btn" id="btnStop">‚èπ Stop</button>
              <div class="range">
                <span>–ì—É—á–Ω—ñ—Å—Ç—å</span>
                <input id="vol" type="range" min="0" max="1" step="0.05" value="0.8" />
              </div>
            </div>

            <div class="stat" id="roundInfo">–†–∞—É–Ω–¥: 1 / 1</div>
            <div class="stat">–ì–ö: <span class="kbd">1</span>‚Ä¶<span class="kbd">5</span> –≤—ñ–¥–∫—Ä–∏—Ç–∏ ¬∑ <span class="kbd">A</span> Answer ¬∑ <span class="kbd">N</span> Next</div>
          </div>

          <!-- –∞—É–¥—ñ–æ –µ–ª–µ–º–µ–Ω—Ç -->
          <audio id="audio" preload="auto"></audio>

        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const PACK_URL = "assets/pack.json";
  const WORDS_COUNT = 5;

  // fallback demo (–±–µ–∑ mp3)
  const demoPack = [
    { id:"001", answer:"DEMO: –ù–∞–∑–≤–∞ –ø—ñ—Å–Ω—ñ 1", audio:null, words:["–Ω—ñ—á","–¥–æ—Ä–æ–≥–∞","–≤–æ–≥–Ω—ñ","–º—ñ—Å—Ç–æ","–ø—É–ª—å—Å"] },
    { id:"002", answer:"DEMO: –ù–∞–∑–≤–∞ –ø—ñ—Å–Ω—ñ 2", audio:null, words:["–ª—ñ—Ç–æ","–º–æ—Ä–µ","–≤—ñ—Ç–µ—Ä","—Ç–∞–Ω—Ü—ñ","—Å–≤–æ–±–æ–¥–∞"] }
  ];

  let pack = demoPack;
  let packName = "demo (fallback)";
  let currentIndex = 0;

  let openedStack = [];
  let wordTiles = [];

  const wordsEl = document.getElementById("words");
  const openedInfoEl = document.getElementById("openedInfo");
  const packInfoEl = document.getElementById("packInfo");
  const roundInfoEl = document.getElementById("roundInfo");

  const btnUndo = document.getElementById("btnUndo");
  const btnReset = document.getElementById("btnReset");
  const btnReveal = document.getElementById("btnReveal");
  const btnAnswer = document.getElementById("btnAnswer");
  const btnNext = document.getElementById("btnNext");

  const answerOverlay = document.getElementById("answerOverlay");
  const answerText = document.getElementById("answerText");

  const btnPlay = document.getElementById("btnPlay");
  const btnStop = document.getElementById("btnStop");
  const vol = document.getElementById("vol");
  const audioEl = document.getElementById("audio");

  function updateMeta(){
    openedInfoEl.textContent = `–í—ñ–¥–∫—Ä–∏—Ç–æ: ${openedStack.length}/${WORDS_COUNT}`;
    packInfoEl.textContent = `–ü–∞–∫: ${packName}`;
    roundInfoEl.textContent = `–†–∞—É–Ω–¥: ${currentIndex + 1} / ${pack.length}`;
    btnUndo.disabled = openedStack.length === 0;

    // –∫–Ω–æ–ø–∫–∞ play –∞–∫—Ç–∏–≤–Ω–∞ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î audio
    const item = pack[currentIndex];
    btnPlay.disabled = !(item && item.audio);
    btnStop.disabled = !(item && item.audio);
  }

  function toggleAnswer(){ answerOverlay.classList.toggle("show"); }
  function hideAnswer(){ answerOverlay.classList.remove("show"); }

  function normalizeWords(words){
    const arr = Array.isArray(words) ? words.map(w => String(w ?? "")) : [];
    while(arr.length < WORDS_COUNT) arr.push("‚Äî");
    return arr.slice(0, WORDS_COUNT);
  }

  function buildBoard(item){
    wordsEl.innerHTML = "";
    openedStack = [];
    wordTiles = [];
    hideAnswer();
    stopAudio();

    const words = normalizeWords(item.words);

    for(let i=0;i<WORDS_COUNT;i++){
      const tile = document.createElement("div");
      tile.className = "wordTile";
      tile.dataset.index = String(i);

      const num = document.createElement("div");
      num.className = "num";
      num.textContent = String(i+1);

      const word = document.createElement("div");
      word.className = "word";
      word.textContent = words[i];

      tile.appendChild(num);
      tile.appendChild(word);
      tile.addEventListener("click", () => openTile(i));

      wordTiles.push(tile);
      wordsEl.appendChild(tile);
    }

    answerText.textContent = item.answer || "‚Äî";

    // –∞—É–¥—ñ–æ
    if(item.audio){
      const src = item.audio.startsWith("assets/") ? item.audio : ("assets/" + item.audio);
      audioEl.src = src;
    } else {
      audioEl.removeAttribute("src");
    }

    updateMeta();
  }

  function openTile(i){
    const tile = wordTiles[i];
    if(!tile || tile.classList.contains("opened")) return;
    tile.classList.add("opened");
    openedStack.push(i);
    updateMeta();
  }

  function undo(){
    const i = openedStack.pop();
    if(i === undefined) return;
    wordTiles[i].classList.remove("opened");
    updateMeta();
  }

  function reset(){
    openedStack = [];
    wordTiles.forEach(t => t.classList.remove("opened"));
    hideAnswer();
    updateMeta();
  }

  function reveal(){
    openedStack = [];
    wordTiles.forEach((t, idx) => {
      t.classList.add("opened");
      openedStack.push(idx);
    });
    updateMeta();
  }

  function next(){
    currentIndex = (currentIndex + 1) % pack.length;
    loadCurrent();
  }

  function loadCurrent(){
    const item = pack[currentIndex] || { answer:"‚Äî", words:["","","","",""], audio:null };
    buildBoard(item);
  }

  // ===== Audio controls =====
  function stopAudio(){
    try{
      audioEl.pause();
      audioEl.currentTime = 0;
    } catch(e){}
    btnPlay.textContent = "‚ñ∂ Play";
  }

  async function togglePlay(){
    if(!audioEl.src){
      return;
    }
    if(audioEl.paused){
      try{
        await audioEl.play(); // –Ω–∞ Android –º–æ–∂–µ –≤–∏–º–∞–≥–∞—Ç–∏ "user gesture" ‚Äî –∫–Ω–æ–ø–∫–∞ –¥–∞—î –π–æ–≥–æ
        btnPlay.textContent = "‚è∏ Pause";
      } catch(e){
        // —è–∫—â–æ –±—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫—É–≤–∞–≤ –∞–≤—Ç–æ–ø–ª–µ–π/–ø–æ–ª—ñ—Ç–∏–∫–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–ª–∏—à–∏–º–æ —è–∫ —î
      }
    } else {
      audioEl.pause();
      btnPlay.textContent = "‚ñ∂ Play";
    }
  }

  vol.addEventListener("input", () => {
    audioEl.volume = Number(vol.value);
  });

  audioEl.addEventListener("ended", () => {
    btnPlay.textContent = "‚ñ∂ Play";
  });

  // ===== Load pack.json =====
  async function loadPack(){
    try{
      const res = await fetch(PACK_URL, { cache: "no-store" });
      if(!res.ok) throw new Error("pack.json not found");
      const data = await res.json();
      if(!Array.isArray(data) || data.length === 0) throw new Error("pack.json empty");

      // —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
      // [{id, answer, audio:"audio/001.mp3", words:[...5]}]
      pack = data.map(x => ({
        id: String(x.id ?? ""),
        answer: String(x.answer ?? ""),
        audio: x.audio ? String(x.audio) : null,
        words: Array.isArray(x.words) ? x.words : []
      }));
      packName = "assets/pack.json";
    } catch(e){
      pack = demoPack;
      packName = "demo (fallback)";
    }
  }

  // ===== Events =====
  btnUndo.addEventListener("click", undo);
  btnReset.addEventListener("click", reset);
  btnReveal.addEventListener("click", reveal);
  btnAnswer.addEventListener("click", toggleAnswer);
  btnNext.addEventListener("click", next);

  btnPlay.addEventListener("click", togglePlay);
  btnStop.addEventListener("click", stopAudio);

  window.addEventListener("keydown", (ev) => {
    const k = ev.key.toLowerCase();
    if(k === "u") undo();
    if(k === "r") reset();
    if(k === "a") toggleAnswer();
    if(k === "n") next();
    if(k === " ") { ev.preventDefault(); togglePlay(); }
    if(k === "s") stopAudio();
    if(k === "1") openTile(0);
    if(k === "2") openTile(1);
    if(k === "3") openTile(2);
    if(k === "4") openTile(3);
    if(k === "5") openTile(4);
  });

  // ===== Start =====
  (async function init(){
    audioEl.volume = Number(vol.value);
    await loadPack();
    currentIndex = 0;
    loadCurrent();
  })();
})();
</script>
</body>
</html>
